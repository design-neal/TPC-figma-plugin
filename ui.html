<!DOCTYPE html>
<html>
<head>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #F3F4F5;
      color: #110F1A;
      display: flex;
      flex-direction: column;
    }

    /* íƒ­ ìŠ¤íƒ€ì¼ */
    .tabs-container {
      position: sticky;
      top: 0;
      z-index: 100;
      background: #F3F4F5;
      border-bottom: 1px solid #D7D8E5;
      flex-shrink: 0;
    }

    .tabs {
      display: flex;
      background: transparent;
      position: relative;
      overflow-x: scroll;
      overflow-y: hidden;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding: 0 20px;
      gap: 24px;
    }

    .tabs::-webkit-scrollbar {
      display: none;
    }

    .tab {
      flex: 0 0 auto;
      height: 42px;
      padding: 0 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 16px;
      font-weight: 500;
      color: #838499;
      background: transparent;
      border: none;
      cursor: grab;
      position: relative;
      white-space: nowrap;
      user-select: none;
    }

    .tab.active {
      color: #110F1A;
      font-weight: 600;
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: #110F1A;
      border-radius: 2px;
    }

    /* ì½˜í…ì¸  ì˜ì—­ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ */
    .content-wrapper {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding-top: 20px;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* íƒ€ì´í‹€ ì„¹ì…˜ */
    .title-section {
      padding: 28px 20px 12px 20px;
    }

    .page-title {
      font-size: 22px;
      font-weight: 700;
      color: #110F1A;
    }

    /* ë©”ì¸ ì»¨í…ì¸  */
    .main-content {
      padding: 0 20px 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    /* ì¹´ë“œ */
    .card {
      background: #fff;
      border-radius: 20px;
      padding: 28px 24px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
      color: #110F1A;
    }

    /* ë„¤ì´ë° ì•„ì´í…œ ë¦¬ìŠ¤íŠ¸ */
    .naming-list {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    .naming-item {
      display: flex;
      align-items: center;
      height: 60px;
      cursor: pointer;
    }

    .naming-item .icon {
      width: 24px;
      height: 24px;
      margin-right: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .naming-item .icon svg {
      width: 24px;
      height: 24px;
    }

    .naming-item .label {
      flex: 1;
      font-size: 14px;
      font-weight: 500;
      color: #110F1A;
    }

    .naming-item .radio {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #D7D8E5;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #D7D8E5;
    }

    .naming-item .radio::after {
      content: '';
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #fff;
    }

    .naming-item .radio.active {
      border-color: #FF424D;
      background: #FF424D;
    }

    /* ë²„íŠ¼ ê·¸ë£¹ */
    .button-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .button-group.horizontal {
      flex-direction: row;
      gap: 8px;
    }

    .button-group.horizontal .btn {
      flex: 1;
    }

    .btn {
      width: 100%;
      height: 52px;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 18px 16px;
    }

    .btn-primary {
      background: #120E33;
      color: #fff;
    }

    .btn-primary:hover {
      background: #1a1545;
    }

    .btn-secondary {
      background: #fff;
      color: #110F1A;
      border: 1px solid #D7D8E5;
    }

    .btn-secondary:hover {
      background: #F9FAFB;
    }

    /* ìƒíƒœ ë©”ì‹œì§€ */
    .status {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 13px;
      margin-top: 10px;
      display: none;
    }

    .status.show {
      display: block;
    }

    .status.success {
      background: #ECFDF5;
      color: #059669;
    }

    .status.error {
      background: #FEF2F2;
      color: #DC2626;
    }

    .status.info {
      background: #EFF6FF;
      color: #2563EB;
    }

    /* Bridge íƒ­ ìŠ¤íƒ€ì¼ */
    .input-group {
      margin-bottom: 16px;
    }

    .input-label {
      font-size: 13px;
      font-weight: 500;
      color: #5A5A73;
      margin-bottom: 8px;
      display: block;
    }

    textarea {
      width: 100%;
      padding: 16px;
      border: 1px solid #D7D8E5;
      border-radius: 12px;
      font-size: 14px;
      resize: none;
      height: 100px;
      font-family: inherit;
      background: #fff;
    }

    textarea:focus {
      outline: none;
      border-color: #110F1A;
    }

    .examples-section {
      margin-top: 20px;
    }

    .examples-title {
      font-size: 12px;
      font-weight: 600;
      color: #9CA3AF;
      margin-bottom: 8px;
    }

    .example-item {
      font-size: 13px;
      color: #5A5A73;
      padding: 12px 16px;
      background: #F3F4F5;
      border-radius: 12px;
      margin-bottom: 6px;
      cursor: pointer;
    }

    .example-item:hover {
      background: #E5E7EB;
    }

    /* ë§ì¶¤ë²• ê²€ì‚¬ ê²°ê³¼ */
    .spell-results {
      margin-top: 10px;
      display: none;
    }

    .spell-results.show {
      display: block;
    }

    .spell-item {
      background: #FFFBEB;
      border: 1px solid #FCD34D;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .spell-item .original {
      color: #DC2626;
      text-decoration: line-through;
    }

    .spell-item .correct {
      color: #059669;
      font-weight: 600;
    }

    .spell-item .fix-btn {
      background: #120E33;
      color: white;
      border: none;
      border-radius: 999px;
      padding: 10px 20px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 12px;
    }

    .spell-ok {
      background: #ECFDF5;
      color: #059669;
      padding: 16px;
      border-radius: 12px;
      font-size: 13px;
    }

    /* ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ */
    .resize-handle {
      position: fixed;
      bottom: 0;
      right: 0;
      width: 16px;
      height: 16px;
      cursor: nwse-resize;
      z-index: 9999;
    }

    .resize-handle::before {
      content: '';
      position: absolute;
      bottom: 3px;
      right: 3px;
      width: 8px;
      height: 8px;
      border-right: 2px solid #C7CAD9;
      border-bottom: 2px solid #C7CAD9;
    }

    /* Data Fill ìŠ¤íƒ€ì¼ */
    .category-tabs {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }

    .category-tab {
      padding: 8px 16px;
      border-radius: 20px;
      border: 1px solid #D7D8E5;
      background: #fff;
      font-size: 13px;
      font-weight: 500;
      color: #5A5A73;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-tab:hover {
      border-color: #110F1A;
    }

    .category-tab.active {
      background: #110F1A;
      border-color: #110F1A;
      color: #fff;
    }

    .field-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      max-height: 280px;
      overflow-y: auto;
    }

    .field-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: #F9FAFB;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .field-item:hover {
      background: #F3F4F5;
    }

    .field-item.selected {
      background: #EEF2FF;
      border: 1px solid #6366F1;
    }

    .field-item .field-name {
      flex: 1;
      font-size: 13px;
      font-weight: 600;
      color: #110F1A;
    }

    .field-item .field-desc {
      font-size: 12px;
      color: #838499;
      margin-right: 8px;
    }

    .field-item .field-check {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 2px solid #D7D8E5;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #fff;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .field-item.selected .field-check {
      background: #6366F1;
      border-color: #6366F1;
    }

    .field-item.selected .field-check::after {
      content: 'âœ“';
      color: #fff;
      font-size: 12px;
      font-weight: 700;
    }

    .data-preview {
      margin-top: 16px;
      padding: 12px 16px;
      background: #F9FAFB;
      border-radius: 12px;
      font-size: 12px;
      color: #5A5A73;
    }

    .data-preview-title {
      font-weight: 600;
      color: #110F1A;
      margin-bottom: 4px;
    }

    .data-preview-value {
      font-family: 'SF Mono', Monaco, monospace;
      color: #6366F1;
    }

    /* Checker íƒ­ ìŠ¤íƒ€ì¼ */
    .checker-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 16px;
    }

    .checker-tab {
      flex: 1;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #D7D8E5;
      background: #fff;
      font-size: 12px;
      font-weight: 600;
      color: #5A5A73;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .checker-tab:hover {
      border-color: #110F1A;
    }

    .checker-tab.active {
      background: #110F1A;
      border-color: #110F1A;
      color: #fff;
    }

    .checker-summary {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .summary-card {
      flex: 1;
      padding: 16px;
      background: #F9FAFB;
      border-radius: 12px;
      text-align: center;
    }

    .summary-card.error {
      background: #FEF2F2;
    }

    .summary-card.success {
      background: #ECFDF5;
    }

    .summary-number {
      font-size: 24px;
      font-weight: 700;
      color: #110F1A;
    }

    .summary-card.error .summary-number {
      color: #DC2626;
    }

    .summary-card.success .summary-number {
      color: #059669;
    }

    .summary-label {
      font-size: 11px;
      color: #838499;
      margin-top: 4px;
    }

    .checker-results {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 300px;
      overflow-y: auto;
    }

    .checker-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      background: #FEF2F2;
      border: 1px solid #FECACA;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .checker-item:hover {
      background: #FEE2E2;
    }

    .checker-item.warning {
      background: #FFFBEB;
      border-color: #FCD34D;
    }

    .checker-item.warning:hover {
      background: #FEF3C7;
    }

    .checker-item-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      flex-shrink: 0;
    }

    .checker-item-icon svg {
      width: 16px;
      height: 16px;
    }

    .checker-item-info {
      flex: 1;
      min-width: 0;
    }

    .checker-item-name {
      font-size: 13px;
      font-weight: 600;
      color: #110F1A;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .checker-item-detail {
      font-size: 11px;
      color: #838499;
      margin-top: 2px;
    }

    .checker-item-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
      background: #DC2626;
      color: #fff;
      flex-shrink: 0;
    }

    .checker-item.warning .checker-item-badge {
      background: #D97706;
    }

    .checker-empty {
      padding: 40px 20px;
      text-align: center;
      color: #838499;
    }

    .checker-empty-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .checker-empty-text {
      font-size: 14px;
      font-weight: 500;
    }

    .checker-empty-subtext {
      font-size: 12px;
      margin-top: 4px;
    }

    .checker-loading {
      padding: 40px 20px;
      text-align: center;
      color: #838499;
    }

    .checker-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid #E5E7EB;
      border-top-color: #110F1A;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 12px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Code2Design íƒ­ ìŠ¤íƒ€ì¼ */
    .code-input-section {
      margin-bottom: 16px;
    }

    .code-textarea {
      width: 100%;
      height: 200px;
      padding: 12px;
      border: 1px solid #D7D8E5;
      border-radius: 12px;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, 'Courier New', monospace;
      resize: none;
      background: #1E1E1E;
      color: #D4D4D4;
      line-height: 1.5;
    }

    .code-textarea:focus {
      outline: none;
      border-color: #6366F1;
    }

    .code-textarea::placeholder {
      color: #6B6B6B;
    }

    .code-type-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .code-type-tab {
      flex: 1;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #D7D8E5;
      background: #fff;
      font-size: 12px;
      font-weight: 600;
      color: #5A5A73;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .code-type-tab:hover {
      border-color: #110F1A;
    }

    .code-type-tab.active {
      background: #110F1A;
      border-color: #110F1A;
      color: #fff;
    }

    /* .pen ì—…ë¡œë“œ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .pen-upload-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #E5E7EB;
    }

    .pen-upload-dropzone {
      border: 2px dashed #D7D8E5;
      border-radius: 12px;
      padding: 28px 20px;
      text-align: center;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      background: #FAFAFA;
      margin-bottom: 12px;
    }

    .pen-upload-dropzone:hover,
    .pen-upload-dropzone.drag-over {
      border-color: #110F1A;
      background: #F0F0F5;
    }

    .pen-upload-icon {
      font-size: 28px;
      margin-bottom: 8px;
    }

    .pen-upload-label {
      font-size: 13px;
      font-weight: 600;
      color: #110F1A;
      margin-bottom: 4px;
    }

    .pen-upload-sub {
      font-size: 11px;
      color: #838499;
    }

    .pen-file-info {
      display: none;
      background: #F0F0F8;
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 12px;
      gap: 10px;
      align-items: center;
    }

    .pen-file-info.show {
      display: flex;
    }

    .pen-file-icon {
      font-size: 20px;
      flex-shrink: 0;
    }

    .pen-file-details {
      flex: 1;
      min-width: 0;
    }

    .pen-file-name {
      font-size: 13px;
      font-weight: 600;
      color: #110F1A;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pen-file-meta {
      font-size: 11px;
      color: #838499;
      margin-top: 2px;
    }

    .pen-frame-list {
      display: none;
      background: #F9FAFB;
      border-radius: 10px;
      padding: 10px 12px;
      margin-bottom: 12px;
      max-height: 140px;
      overflow-y: auto;
    }

    .pen-frame-list.show {
      display: block;
    }

    .pen-frame-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 5px 0;
      border-bottom: 1px solid #E5E7EB;
      font-size: 12px;
      color: #333;
    }

    .pen-frame-item:last-child {
      border-bottom: none;
    }

    .pen-frame-item input[type="checkbox"] {
      width: 14px;
      height: 14px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .pen-frame-item-name {
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pen-frame-item-size {
      font-size: 10px;
      color: #838499;
      flex-shrink: 0;
    }

    /* .pen ë³€í™˜ ì§„í–‰ ë°” */
    .pen-progress {
      margin-top: 12px;
      padding: 12px 14px;
      background: #F0F0F8;
      border-radius: 10px;
    }

    .pen-progress-label {
      font-size: 12px;
      font-weight: 600;
      color: #110F1A;
      margin-bottom: 8px;
    }

    .pen-progress-bar-wrap {
      width: 100%;
      height: 6px;
      background: #D7D8E5;
      border-radius: 99px;
      overflow: hidden;
      margin-bottom: 6px;
    }

    .pen-progress-bar {
      height: 100%;
      background: #110F1A;
      border-radius: 99px;
      transition: width 0.3s ease;
    }

    .pen-progress-name {
      font-size: 11px;
      color: #838499;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Variables íƒ­ ìŠ¤íƒ€ì¼ */
    .variable-type-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .variable-type-tab {
      flex: 1;
      padding: 10px 8px;
      border-radius: 10px;
      border: 1px solid #D7D8E5;
      background: #fff;
      font-size: 11px;
      font-weight: 600;
      color: #5A5A73;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .variable-type-tab:hover {
      border-color: #110F1A;
    }

    .variable-type-tab.active {
      background: #110F1A;
      border-color: #110F1A;
      color: #fff;
    }

    .variable-preview-item {
      display: flex;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px solid #E5E7EB;
      gap: 10px;
    }

    .variable-preview-item:last-child {
      border-bottom: none;
    }

    .variable-color-swatch {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      border: 1px solid #D7D8E5;
      flex-shrink: 0;
    }

    .variable-name {
      flex: 1;
      font-size: 12px;
      font-weight: 500;
      color: #374151;
      font-family: monospace;
    }

    .variable-value {
      font-size: 12px;
      color: #6B7280;
      font-family: monospace;
    }

    .variable-type-badge {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 4px;
      font-weight: 600;
    }

    .variable-type-badge.color {
      background: #DBEAFE;
      color: #1D4ED8;
    }

    .variable-type-badge.number {
      background: #D1FAE5;
      color: #047857;
    }

    .variable-type-badge.string {
      background: #FEF3C7;
      color: #92400E;
    }

    .code-preview {
      background: #F9FAFB;
      border: 1px solid #E5E7EB;
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }

    .code-preview-title {
      font-size: 12px;
      font-weight: 600;
      color: #5A5A73;
      margin-bottom: 8px;
    }

    .code-preview-info {
      font-size: 13px;
      color: #110F1A;
    }

    /* ë²„íŠ¼ ë¡œë”© ìŠ¤íƒ€ì¼ */
    .btn-loading {
      display: none;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: btn-spin 0.8s linear infinite;
    }

    @keyframes btn-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .btn.loading {
      pointer-events: none;
      opacity: 0.8;
    }

    .btn.loading .btn-text {
      display: none !important;
    }

    .btn.loading .btn-loading {
      display: flex !important;
    }

    /* Compare íƒ­ ìŠ¤íƒ€ì¼ */
    .compare-input-section {
      margin-bottom: 16px;
    }

    .compare-textarea {
      width: 100%;
      height: 120px;
      padding: 12px;
      border: 1px solid #D7D8E5;
      border-radius: 12px;
      font-size: 13px;
      font-family: inherit;
      resize: none;
      background: #fff;
    }

    .compare-textarea:focus {
      outline: none;
      border-color: #110F1A;
    }

    .compare-source-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .compare-source-tab {
      flex: 1;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid #D7D8E5;
      background: #fff;
      font-size: 12px;
      font-weight: 600;
      color: #5A5A73;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .compare-source-tab:hover {
      border-color: #110F1A;
    }

    .compare-source-tab.active {
      background: #110F1A;
      border-color: #110F1A;
      color: #fff;
    }

    .compare-results {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 280px;
      overflow-y: auto;
    }

    .compare-item {
      display: flex;
      align-items: flex-start;
      padding: 12px 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .compare-item.match {
      background: #ECFDF5;
      border: 1px solid #A7F3D0;
    }

    .compare-item.mismatch {
      background: #FEF2F2;
      border: 1px solid #FECACA;
    }

    .compare-item.missing {
      background: #FFFBEB;
      border: 1px solid #FCD34D;
    }

    .compare-item:hover {
      opacity: 0.9;
    }

    .compare-item-icon {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      flex-shrink: 0;
      font-size: 14px;
    }

    .compare-item.match .compare-item-icon {
      background: #D1FAE5;
    }

    .compare-item.mismatch .compare-item-icon {
      background: #FEE2E2;
    }

    .compare-item.missing .compare-item-icon {
      background: #FEF3C7;
    }

    .compare-item-content {
      flex: 1;
      min-width: 0;
    }

    .compare-item-label {
      font-size: 11px;
      font-weight: 600;
      color: #838499;
      margin-bottom: 4px;
    }

    .compare-item-text {
      font-size: 13px;
      color: #110F1A;
      word-break: break-word;
    }

    .compare-item-diff {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px dashed #E5E7EB;
    }

    .compare-item-expected {
      font-size: 12px;
      color: #059669;
    }

    .compare-item-actual {
      font-size: 12px;
      color: #DC2626;
      margin-top: 2px;
    }

    .compare-summary-bar {
      display: flex;
      gap: 12px;
      padding: 12px 16px;
      background: #F9FAFB;
      border-radius: 12px;
      margin-bottom: 12px;
    }

    .compare-stat {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 600;
    }

    .compare-stat-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .compare-stat-dot.match { background: #059669; }
    .compare-stat-dot.mismatch { background: #DC2626; }
    .compare-stat-dot.missing { background: #D97706; }

    .notion-url-input {
      width: 100%;
      padding: 12px;
      border: 1px solid #D7D8E5;
      border-radius: 12px;
      font-size: 13px;
      background: #fff;
      margin-bottom: 8px;
    }

    .notion-url-input:focus {
      outline: none;
      border-color: #110F1A;
    }

  </style>
</head>
<body>
  <!-- ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ -->
  <div class="resize-handle" id="resizeHandle"></div>

  <!-- íƒ­ í—¤ë” -->
  <div class="tabs-container">
    <div class="tabs" id="tabsScroller">
      <button class="tab active" data-tab="export">Data Fill</button>
      <button class="tab" data-tab="bridge">Text Editor</button>
      <button class="tab" data-tab="rename">Rename</button>
      <button class="tab" data-tab="code2design">Code2Design</button>
      <button class="tab" data-tab="variables">Variables</button>
      <button class="tab" data-tab="style">Checker</button>
    </div>
  </div>

  <!-- ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì½˜í…ì¸  ì˜ì—­ -->
  <div class="content-wrapper">

  <!-- Rename íƒ­ -->
  <div class="tab-content" id="rename-tab">
    <div class="main-content">
      <div class="card">
        <h2 class="card-title">Selected Naming</h2>
        <div class="naming-list">
          <div class="naming-item" data-value="Content">
            <div class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="#110F1A" stroke-width="2">
                <rect x="3" y="3" width="7" height="7"/>
                <rect x="14" y="3" width="7" height="7"/>
                <rect x="3" y="14" width="7" height="7"/>
                <rect x="14" y="14" width="7" height="7"/>
              </svg>
            </div>
            <span class="label">Content</span>
            <div class="radio active"></div>
          </div>
          <div class="naming-item" data-value="Section">
            <div class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="#110F1A" stroke-width="2">
                <rect x="3" y="3" width="18" height="6" rx="1"/>
                <rect x="3" y="12" width="18" height="9" rx="1"/>
              </svg>
            </div>
            <span class="label">Section</span>
            <div class="radio"></div>
          </div>
          <div class="naming-item" data-value="Item">
            <div class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="#110F1A" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <line x1="9" y1="3" x2="9" y2="21"/>
              </svg>
            </div>
            <span class="label">Item</span>
            <div class="radio"></div>
          </div>
          <div class="naming-item" data-value="Image">
            <div class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="#110F1A" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2"/>
                <circle cx="8.5" cy="8.5" r="1.5"/>
                <path d="M21 15l-5-5L5 21"/>
              </svg>
            </div>
            <span class="label">Image</span>
            <div class="radio"></div>
          </div>
          <div class="naming-item" data-value="Text">
            <div class="icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="#110F1A" stroke-width="2">
                <polyline points="4 7 4 4 20 4 20 7"/>
                <line x1="9" y1="20" x2="15" y2="20"/>
                <line x1="12" y1="4" x2="12" y2="20"/>
              </svg>
            </div>
            <span class="label">Text</span>
            <div class="radio"></div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" id="selectedChangeBtn">ì„ íƒ ë ˆì´ì–´ ë³€ê²½</button>
          <button class="btn btn-secondary" id="autoRenameBtn">ìë™ ë„¤ì´ë°</button>
        </div>
      </div>

      <div class="status" id="renameStatus"></div>
    </div>
  </div>

  <!-- Bridge íƒ­ -->
  <div class="tab-content" id="bridge-tab">
    <div class="main-content">
      <!-- ì§ì ‘ í…ìŠ¤íŠ¸ ë³€ê²½ ì¹´ë“œ -->
      <div class="card">
        <h2 class="card-title">í…ìŠ¤íŠ¸ ì§ì ‘ ë³€ê²½</h2>
        <div class="input-group">
          <textarea id="directText" placeholder="ì„ íƒí•œ ë ˆì´ì–´ì˜ í…ìŠ¤íŠ¸ë¥¼ ì´ ë‚´ìš©ìœ¼ë¡œ ë³€ê²½í•©ë‹ˆë‹¤"></textarea>
        </div>
        <div class="button-group">
          <button class="btn btn-primary" id="directChangeBtn">
            <span class="btn-text">ì„ íƒ ë ˆì´ì–´ í…ìŠ¤íŠ¸ ë³€ê²½</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ë³€ê²½ ì¤‘...
            </span>
          </button>
        </div>
      </div>

      <!-- ì°¾ì•„ì„œ ë³€ê²½ ì¹´ë“œ -->
      <div class="card">
        <h2 class="card-title">ì°¾ì•„ì„œ ë³€ê²½</h2>
        <div class="input-group">
          <textarea id="command" placeholder="ì˜ˆ: ê¸°ì¡´í…ìŠ¤íŠ¸>ìƒˆí…ìŠ¤íŠ¸"></textarea>
        </div>

        <div class="button-group horizontal">
          <button class="btn btn-secondary" id="spellCheckBtn">
            <span class="btn-text">ë§ì¶¤ë²• ê²€ì‚¬</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ê²€ì‚¬ ì¤‘...
            </span>
          </button>
          <button class="btn btn-primary" id="executeBtn">
            <span class="btn-text">í…ìŠ¤íŠ¸ ë³€ê²½</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ë³€ê²½ ì¤‘...
            </span>
          </button>
        </div>

        <div class="examples-section">
          <div class="examples-title">ëª…ë ¹ì–´ ì˜ˆì‹œ</div>
          <div class="example-item" data-cmd="íŒ”ë¡œì›Œ(ì „ì²´)>ì „ì²´ ë©”ì‹œì§€">ì°¾ì•„ì„œ ë³€ê²½: ê¸°ì¡´í…ìŠ¤íŠ¸>ìƒˆí…ìŠ¤íŠ¸</div>
          <div class="example-item" data-cmd=">ìƒˆ í…ìŠ¤íŠ¸">ì „ì²´ ë³€ê²½: >ìƒˆí…ìŠ¤íŠ¸</div>
        </div>
      </div>

      <div class="status" id="bridgeStatus"></div>
      <div class="spell-results" id="spellResults"></div>
    </div>
  </div>

  <!-- Data Fill íƒ­ -->
  <div class="tab-content active" id="export-tab">
    <div class="main-content">
      <div class="card">
        <div class="category-tabs">
          <button class="category-tab active" data-category="creator">í¬ë¦¬ì—ì´í„°</button>
          <button class="category-tab" data-category="fan">íŒ¬</button>
        </div>

        <div class="field-list" id="fieldList">
          <!-- í•„ë“œ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
        </div>

        <div class="data-preview" id="dataPreview" style="display: none;">
          <div class="data-preview-title">ë¯¸ë¦¬ë³´ê¸°</div>
          <div class="data-preview-value" id="previewValue"></div>
        </div>

        <div class="button-group" style="margin-top: 16px;">
          <button class="btn btn-primary" id="applyDataBtn">ì„ íƒ ë ˆì´ì–´ì— ì ìš©</button>
          <button class="btn btn-secondary" id="randomFillBtn">ëœë¤ ì±„ìš°ê¸°</button>
        </div>
      </div>

      <div class="status" id="dataFillStatus"></div>
    </div>
  </div>

  <!-- Code2Design íƒ­ -->
  <div class="tab-content" id="code2design-tab">
    <div class="main-content">
      <div class="card">
        <h2 class="card-title">Code â†’ Figma Design</h2>

        <div class="code-type-tabs">
          <button class="code-type-tab active" data-codetype="react" onclick="selectCodeType(this, 'react')">
            âš›ï¸ React
          </button>
          <button class="code-type-tab" data-codetype="html" onclick="selectCodeType(this, 'html')">
            ğŸŒ HTML/CSS
          </button>
        </div>

        <div class="code-input-section">
          <label class="input-label">React/HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”</label>
          <textarea class="code-textarea" id="codeInput" placeholder="// React ì»´í¬ë„ŒíŠ¸ ë˜ëŠ” HTML ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”
// CSS ìŠ¤íƒ€ì¼ë„ í•¨ê»˜ ë¶™ì—¬ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ íŒŒì‹±ë©ë‹ˆë‹¤

export default function Component() {
  return (
    <div style={{ padding: 20 }}>
      <h1>Hello World</h1>
    </div>
  );
}"></textarea>
        </div>

        <div class="button-group">
          <button class="btn btn-primary" id="generateDesignBtn" onclick="generateDesign()">
            <span class="btn-text">ğŸ¨ Figma ë””ìì¸ ìƒì„±</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ìƒì„± ì¤‘...
            </span>
          </button>
        </div>

        <div class="code-preview" id="codePreview" style="display: none;">
          <div class="code-preview-title">íŒŒì‹± ê²°ê³¼</div>
          <div class="code-preview-info" id="codePreviewInfo"></div>
        </div>
      </div>

      <div class="status" id="code2designStatus"></div>

      <!-- .pen íŒŒì¼ ì—…ë¡œë“œ ì¹´ë“œ -->
      <div class="card" style="margin-top: 12px;">
        <h2 class="card-title">.pen â†’ Figma Frame</h2>
        <p class="card-desc" style="color: #838499; font-size: 13px; margin-bottom: 16px;">
          Pencil .pen íŒŒì¼ì˜ í”„ë ˆì„ì„ Figma í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤
        </p>

        <!-- ë“œë¡­ì¡´ -->
        <div class="pen-upload-dropzone" id="penDropzone" onclick="document.getElementById('penFileInput').click()">
          <div class="pen-upload-icon">ğŸ“‚</div>
          <div class="pen-upload-label">.pen íŒŒì¼ì„ ì„ íƒí•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì„¸ìš”</div>
          <div class="pen-upload-sub">Pencil ë””ìì¸ íŒŒì¼ (.pen)</div>
        </div>
        <input type="file" id="penFileInput" accept=".pen" style="display: none;">

        <!-- íŒŒì¼ ì •ë³´ -->
        <div class="pen-file-info" id="penFileInfo">
          <div class="pen-file-icon">ğŸ–Šï¸</div>
          <div class="pen-file-details">
            <div class="pen-file-name" id="penFileName">íŒŒì¼ëª….pen</div>
            <div class="pen-file-meta" id="penFileMeta">0ê°œ í”„ë ˆì„</div>
          </div>
          <button class="btn btn-secondary" style="padding: 6px 10px; font-size: 11px; min-width: auto;" onclick="clearPenFile()">âœ•</button>
        </div>

        <!-- í”„ë ˆì„ ëª©ë¡ (ì²´í¬ë°•ìŠ¤) -->
        <div class="pen-frame-list" id="penFrameList"></div>

        <div class="button-group">
          <button class="btn btn-primary" id="convertPenBtn" onclick="convertPenFrames()" style="display: none;">
            <span class="btn-text">ğŸ”„ Figma í”„ë ˆì„ìœ¼ë¡œ ë³€í™˜</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ë³€í™˜ ì¤‘...
            </span>
          </button>
        </div>

        <!-- ë³€í™˜ ì§„í–‰ ë°” -->
        <div class="pen-progress" id="penProgress" style="display:none;">
          <div class="pen-progress-label" id="penProgressLabel">ë³€í™˜ ì¤‘... (0/0)</div>
          <div class="pen-progress-bar-wrap">
            <div class="pen-progress-bar" id="penProgressBar" style="width:0%"></div>
          </div>
          <div class="pen-progress-name" id="penProgressName"></div>
        </div>

        <div class="status" id="penConvertStatus"></div>
      </div>
    </div>
  </div>

  <!-- Variables íƒ­ -->
  <div class="tab-content" id="variables-tab">
    <div class="main-content">
      <div class="card">
        <h2 class="card-title">ğŸ¨ Design Token â†’ Variables</h2>
        <p class="card-desc" style="color: #838499; font-size: 13px; margin-bottom: 16px;">
          JSON í˜•ì‹ì˜ ë””ìì¸ í† í°ì„ Figma ë² ë¦¬ì–´ë¸”ë¡œ ë³€í™˜í•©ë‹ˆë‹¤
        </p>

        <div class="variable-type-tabs">
          <button class="variable-type-tab active" data-vartype="color" onclick="selectVariableType(this, 'color')">
            ğŸ¨ Color
          </button>
          <button class="variable-type-tab" data-vartype="number" onclick="selectVariableType(this, 'number')">
            ğŸ“ Number
          </button>
          <button class="variable-type-tab" data-vartype="string" onclick="selectVariableType(this, 'string')">
            ğŸ“ String
          </button>
          <button class="variable-type-tab" data-vartype="auto" onclick="selectVariableType(this, 'auto')">
            ğŸ”„ Auto
          </button>
        </div>

        <div class="code-input-section">
          <label class="input-label">Collection ì´ë¦„</label>
          <input type="text" class="input-text" id="collectionName" placeholder="Design Tokens" value="Design Tokens" style="margin-bottom: 12px;">

          <label class="input-label">JSON í† í° ì…ë ¥</label>
          <textarea class="code-textarea" id="variableJsonInput" placeholder='{
  "color/primary/500": "#3B82F6",
  "color/primary/600": "#2563EB",
  "color/neutral/100": "#F3F4F6",
  "spacing/xs": 4,
  "spacing/sm": 8,
  "spacing/md": 16,
  "spacing/lg": 24,
  "radius/sm": 4,
  "radius/md": 8,
  "radius/lg": 12,
  "font/family/primary": "Inter"
}'></textarea>
        </div>

        <div class="variable-preview" id="variablePreview" style="display: none; margin-top: 16px;">
          <div class="variable-preview-title" style="font-weight: 600; margin-bottom: 8px;">ğŸ“‹ ë¯¸ë¦¬ë³´ê¸°</div>
          <div class="variable-preview-list" id="variablePreviewList" style="max-height: 200px; overflow-y: auto; background: #F9FAFB; border-radius: 8px; padding: 12px;"></div>
        </div>

        <div class="button-group" style="margin-top: 16px;">
          <button class="btn btn-secondary" onclick="previewVariables()">
            ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°
          </button>
          <button class="btn btn-primary" id="createVariablesBtn" onclick="createVariables()">
            <span class="btn-text">âœ¨ ë² ë¦¬ì–´ë¸” ìƒì„±</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ìƒì„± ì¤‘...
            </span>
          </button>
        </div>

        <div class="button-group" style="margin-top: 8px;">
          <button class="btn btn-primary" id="createTextStylesBtn" onclick="createTextStyles()" style="background: #6366F1;">
            <span class="btn-text">ğŸ”¤ Text Styles ìƒì„±</span>
            <span class="btn-loading">
              <span class="btn-spinner"></span>
              ìƒì„± ì¤‘...
            </span>
          </button>
        </div>
      </div>

      <div class="card" style="margin-top: 10px;">
        <h3 class="card-title" style="font-size: 16px;">ğŸ’¡ ë² ë¦¬ì–´ë¸” ì˜ˆì‹œ</h3>
        <div class="example-tokens" style="background: #F9FAFB; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 12px; color: #374151; white-space: pre-wrap;">{
  "color/primary/500": "#3B82F6",
  "spacing/md": 16,
  "radius/lg": 12
}</div>
      </div>

      <div class="card" style="margin-top: 10px;">
        <h3 class="card-title" style="font-size: 16px;">ğŸ”¤ Text Styles ì˜ˆì‹œ</h3>
        <div class="example-tokens" style="background: #F9FAFB; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 11px; color: #374151; white-space: pre-wrap;">[
  {
    "name": "Typography/Body 1",
    "fontFamily": "Inter",
    "fontWeight": "Regular",
    "fontSize": 14,
    "lineHeight": 20
  },
  {
    "name": "Typography/Title 1",
    "fontFamily": "Inter",
    "fontWeight": "Bold",
    "fontSize": 32,
    "lineHeight": 40
  }
]</div>
        <p style="color: #838499; font-size: 12px; margin-top: 8px;">
          â€¢ name: ìŠ¤íƒ€ì¼ ì´ë¦„ (ê³„ì¸µ êµ¬ì¡° ê°€ëŠ¥)<br>
          â€¢ fontWeight: Regular, Medium, Semibold, Bold<br>
          â€¢ fontSize, lineHeight: í”½ì…€ ë‹¨ìœ„
        </p>
      </div>

      <div class="status" id="variablesStatus"></div>
    </div>
  </div>

  <!-- Checker íƒ­ -->
  <div class="tab-content" id="style-tab">
    <div class="main-content">
      <div class="card">
        <h2 class="card-title">Design System Checker</h2>

        <div class="checker-tabs">
          <button class="checker-tab active" data-checker="component">
            ğŸ§© ì»´í¬ë„ŒíŠ¸
          </button>
          <button class="checker-tab" data-checker="variable">
            ğŸ¨ ë² ë¦¬ì–´ë¸”
          </button>
          <button class="checker-tab" data-checker="textstyle">
            ğŸ“ í…ìŠ¤íŠ¸
          </button>
        </div>

        <div class="checker-summary" id="checkerSummary">
          <div class="summary-card" id="summaryTotal">
            <div class="summary-number">-</div>
            <div class="summary-label">ì „ì²´ ë ˆì´ì–´</div>
          </div>
          <div class="summary-card error" id="summaryError">
            <div class="summary-number">-</div>
            <div class="summary-label">ë¯¸ì ìš©</div>
          </div>
          <div class="summary-card success" id="summarySuccess">
            <div class="summary-number">-</div>
            <div class="summary-label">ì ìš©ë¨</div>
          </div>
        </div>

        <div class="checker-results" id="checkerResults">
          <div class="checker-empty">
            <div class="checker-empty-icon">ğŸ”</div>
            <div class="checker-empty-text">ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ê³  ìŠ¤ìº”í•˜ì„¸ìš”</div>
            <div class="checker-empty-subtext">ì„ íƒí•œ ë ˆì´ì–´ì—ì„œ ë””ìì¸ ì‹œìŠ¤í…œ ì ìš© ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</div>
          </div>
        </div>

        <div class="button-group" style="margin-top: 16px;">
          <button class="btn btn-primary" id="scanDesignBtn">ğŸ” ì„ íƒ ë ˆì´ì–´ ìŠ¤ìº”</button>
          <button class="btn btn-secondary" id="selectAllErrorsBtn">âš ï¸ ë¯¸ì ìš© ë ˆì´ì–´ ëª¨ë‘ ì„ íƒ</button>
        </div>
      </div>

      <div class="status" id="checkerStatus"></div>
    </div>
  </div>

  </div><!-- content-wrapper ë‹«ê¸° -->

  <script>
    // ===== ì „ì—­ ë³€ìˆ˜ =====
    let currentCodeType = 'react';  // Code2Design íƒ­ìš©
    let currentVariableType = 'auto';  // Variables íƒ­ìš©

    // ===== íƒ­ ë“œë˜ê·¸ ìŠ¤í¬ë¡¤ =====
    const tabsScroller = document.getElementById('tabsScroller');
    let isTabDragging = false;
    let tabStartX;
    let tabScrollLeft;

    tabsScroller.addEventListener('mousedown', (e) => {
      isTabDragging = true;
      tabsScroller.style.cursor = 'grabbing';
      tabStartX = e.pageX - tabsScroller.offsetLeft;
      tabScrollLeft = tabsScroller.scrollLeft;
    });

    tabsScroller.addEventListener('mouseleave', () => {
      isTabDragging = false;
      tabsScroller.style.cursor = 'grab';
    });

    tabsScroller.addEventListener('mouseup', () => {
      isTabDragging = false;
      tabsScroller.style.cursor = 'grab';
    });

    tabsScroller.addEventListener('mousemove', (e) => {
      if (!isTabDragging) return;
      e.preventDefault();
      const x = e.pageX - tabsScroller.offsetLeft;
      const walk = (x - tabStartX) * 1.5;
      tabsScroller.scrollLeft = tabScrollLeft - walk;
    });

    // íƒ­ ì „í™˜
    document.querySelectorAll('.tab').forEach(tab => {
      tab.onclick = (e) => {
        // ë“œë˜ê·¸ ì¤‘ì´ë©´ í´ë¦­ ë¬´ì‹œ
        if (Math.abs(e.pageX - tabsScroller.offsetLeft - tabStartX) > 5) return;

        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab + '-tab').classList.add('active');
      };
    });

    // ===== Rename íƒ­ =====
    let selectedNaming = 'Content';
    const renameStatus = document.getElementById('renameStatus');

    document.querySelectorAll('.naming-item').forEach(item => {
      item.onclick = () => {
        document.querySelectorAll('.naming-item .radio').forEach(r => r.classList.remove('active'));
        item.querySelector('.radio').classList.add('active');
        selectedNaming = item.dataset.value;
      };
    });

    function showRenameStatus(message, type) {
      renameStatus.textContent = message;
      renameStatus.className = 'status show ' + type;
    }

    document.getElementById('selectedChangeBtn').onclick = () => {
      showRenameStatus('ì²˜ë¦¬ ì¤‘...', 'info');
      parent.postMessage({
        pluginMessage: { type: 'rename-selected', namingType: selectedNaming }
      }, '*');
    };

    document.getElementById('autoRenameBtn').onclick = () => {
      showRenameStatus('ìë™ ë„¤ì´ë° ì¤‘...', 'info');
      parent.postMessage({ pluginMessage: { type: 'auto-rename' } }, '*');
    };

    // ===== Bridge íƒ­ =====
    const commandInput = document.getElementById('command');
    const directTextInput = document.getElementById('directText');
    const bridgeStatus = document.getElementById('bridgeStatus');
    const spellResults = document.getElementById('spellResults');

    function showBridgeStatus(message, type) {
      bridgeStatus.textContent = message;
      bridgeStatus.className = 'status show ' + type;
    }

    // ì§ì ‘ í…ìŠ¤íŠ¸ ë³€ê²½ ë²„íŠ¼
    const directChangeBtn = document.getElementById('directChangeBtn');
    directChangeBtn.onclick = () => {
      const newText = directTextInput.value;
      if (!newText) {
        showBridgeStatus('ë³€ê²½í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      directChangeBtn.classList.add('loading');
      showBridgeStatus('í…ìŠ¤íŠ¸ ë³€ê²½ ì¤‘...', 'info');
      parent.postMessage({
        pluginMessage: { type: 'direct-text-change', text: newText }
      }, '*');
    };

    const executeBtn = document.getElementById('executeBtn');
    executeBtn.onclick = () => {
      const command = commandInput.value.trim();
      if (!command) {
        showBridgeStatus('ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      executeBtn.classList.add('loading');
      showBridgeStatus('ì²˜ë¦¬ ì¤‘...', 'info');
      parent.postMessage({ pluginMessage: { type: 'execute-command', command } }, '*');
    };

    const spellCheckBtn = document.getElementById('spellCheckBtn');
    spellCheckBtn.onclick = () => {
      spellCheckBtn.classList.add('loading');
      showBridgeStatus('ë§ì¶¤ë²• ê²€ì‚¬ ì¤‘...', 'info');
      spellResults.className = 'spell-results';
      spellResults.innerHTML = '';
      parent.postMessage({ pluginMessage: { type: 'spell-check' } }, '*');
    };

    document.querySelectorAll('.example-item').forEach(el => {
      el.onclick = () => { commandInput.value = el.dataset.cmd; };
    });

    // ===== ë©”ì‹œì§€ ìˆ˜ì‹  =====
    let selectionCount = 0;  // í˜„ì¬ Figmaì—ì„œ ì„ íƒëœ ë ˆì´ì–´ ê°œìˆ˜
    let matchingLayerCount = 0;  // ì„ íƒëœ í•„ë“œëª…ê³¼ ì¼ì¹˜í•˜ëŠ” ë ˆì´ì–´ ê°œìˆ˜

    // Code2Design ìƒíƒœ í‘œì‹œ í•¨ìˆ˜ (ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ë³´ë‹¤ ë¨¼ì € ì •ì˜)
    function showCode2DesignStatus(message, type) {
      const statusEl = document.getElementById('code2designStatus');
      if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = 'status show ' + type;
      }
    }

    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;  // ë©”ì‹œì§€ê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ

      if (msg.type === 'status') {
        showBridgeStatus(msg.message, msg.status);
        // ì„±ê³µ ë˜ëŠ” ì—ëŸ¬ ì‹œ ë¡œë”© í•´ì œ
        if (msg.status === 'success' || msg.status === 'error') {
          const directBtn = document.getElementById('directChangeBtn');
          const execBtn = document.getElementById('executeBtn');
          if (directBtn) directBtn.classList.remove('loading');
          if (execBtn) execBtn.classList.remove('loading');
        }
      }
      if (msg.type === 'rename-status') showRenameStatus(msg.message, msg.status);
      if (msg.type === 'data-fill-status') showDataFillStatus(msg.message, msg.status);

      // Figma ì„ íƒ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
      if (msg.type === 'selection-update') {
        selectionCount = msg.count;
        matchingLayerCount = msg.matchingCount || 0;
        updatePreview();
      }

      if (msg.type === 'spell-results') {
        bridgeStatus.className = 'status';
        spellResults.className = 'spell-results show';
        // ë§ì¶¤ë²• ê²€ì‚¬ ë¡œë”© í•´ì œ
        const spellBtn = document.getElementById('spellCheckBtn');
        if (spellBtn) spellBtn.classList.remove('loading');

        if (msg.errors.length === 0) {
          spellResults.innerHTML = '<div class="spell-ok">ë§ì¶¤ë²• ì˜¤ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤!</div>';
        } else {
          spellResults.innerHTML = msg.errors.map((err, idx) => `
            <div class="spell-item">
              <div><span class="original">${err.original}</span> â†’ <span class="correct">${err.correct}</span></div>
              <div style="color:#5A5A73;margin-top:6px;font-size:12px;">${err.help || ''}</div>
              <button class="fix-btn" data-idx="${idx}">ìˆ˜ì •í•˜ê¸°</button>
            </div>
          `).join('');

          spellResults.querySelectorAll('.fix-btn').forEach(btn => {
            btn.onclick = () => {
              const idx = parseInt(btn.dataset.idx);
              const err = msg.errors[idx];
              parent.postMessage({
                pluginMessage: { type: 'execute-command', command: `${err.original}>${err.correct}` }
              }, '*');
            };
          });
        }
      }

      if (msg.type === 'check-spelling') checkSpelling(msg.texts);

      // Code2Design ê´€ë ¨ ë©”ì‹œì§€
      if (msg.type === 'code2design-status') {
        showCode2DesignStatus(msg.message, msg.status);
        // ì„±ê³µ ë˜ëŠ” ì—ëŸ¬ ì‹œ ë¡œë”© í•´ì œ
        if (msg.status === 'success' || msg.status === 'error') {
          const btn = document.getElementById('generateDesignBtn');
          if (btn) btn.classList.remove('loading');
        }
      }

      // .pen ë³€í™˜ ì§„í–‰ ìƒí™©
      if (msg.type === 'pen-convert-progress') {
        const pct = Math.round((msg.current / msg.total) * 100);
        const progressEl = document.getElementById('penProgress');
        const labelEl = document.getElementById('penProgressLabel');
        const barEl = document.getElementById('penProgressBar');
        const nameEl = document.getElementById('penProgressName');
        if (progressEl) progressEl.style.display = 'block';
        if (labelEl) labelEl.textContent = 'ë³€í™˜ ì¤‘... (' + msg.current + '/' + msg.total + ')';
        if (barEl) barEl.style.width = pct + '%';
        if (nameEl) nameEl.textContent = msg.name;
      }

      // .pen ë³€í™˜ ì™„ë£Œ/ì—ëŸ¬
      if (msg.type === 'pen-convert-status') {
        const progressEl = document.getElementById('penProgress');
        const barEl = document.getElementById('penProgressBar');
        const labelEl = document.getElementById('penProgressLabel');
        if (msg.status === 'success' || msg.status === 'warning') {
          if (barEl) barEl.style.width = '100%';
          if (labelEl) labelEl.textContent = 'ë³€í™˜ ì™„ë£Œ!';
          setTimeout(function() {
            if (progressEl) progressEl.style.display = 'none';
          }, 2000);
        } else {
          if (progressEl) progressEl.style.display = 'none';
        }
        showPenStatus(msg.message, msg.status);
        const btn = document.getElementById('convertPenBtn');
        if (btn) btn.classList.remove('loading');
      }

      // Variables ê´€ë ¨ ë©”ì‹œì§€
      if (msg.type === 'variables-status') {
        showVariablesStatus(msg.message, msg.status);
        // ì„±ê³µ ë˜ëŠ” ì—ëŸ¬ ì‹œ ë¡œë”© í•´ì œ
        if (msg.status === 'success' || msg.status === 'error' || msg.status === 'warning') {
          const btn1 = document.getElementById('createVariablesBtn');
          const btn2 = document.getElementById('createTextStylesBtn');
          if (btn1) btn1.classList.remove('loading');
          if (btn2) btn2.classList.remove('loading');
        }
      }

      // Checker ê´€ë ¨ ë©”ì‹œì§€
      if (msg.type === 'checker-status') showCheckerStatus(msg.message, msg.status);
      if (msg.type === 'checker-results') {
        checkerResults[msg.checkerType] = msg.results;
        renderCheckerResults();
        showCheckerStatus(`ìŠ¤ìº” ì™„ë£Œ: ${msg.results.filter(r => !r.isApplied).length}ê°œ ë¯¸ì ìš© ë°œê²¬`, 'success');
      }

      // Compare ê´€ë ¨ ë©”ì‹œì§€
      if (msg.type === 'compare-status') showCompareStatus(msg.message, msg.status);
      if (msg.type === 'compare-results') {
        renderCompareResults(msg.results);
        const mismatchCount = msg.results.filter(r => r.status === 'mismatch').length;
        const missingCount = msg.results.filter(r => r.status === 'missing').length;
        if (mismatchCount + missingCount === 0) {
          showCompareStatus('ëª¨ë“  ë‚´ìš©ì´ ì¼ì¹˜í•©ë‹ˆë‹¤! ğŸ‰', 'success');
        } else {
          showCompareStatus(`${mismatchCount}ê°œ ë¶ˆì¼ì¹˜, ${missingCount}ê°œ ëˆ„ë½ ë°œê²¬`, 'error');
        }
      }
    };

    async function checkSpelling(texts) {
      const errors = [];
      for (const text of texts) {
        try {
          const response = await fetch('https://m.search.naver.com/p/csearch/ocontent/util/SpellerProxy', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `q=${encodeURIComponent(text)}`
          });
          const data = await response.json();
          if (data.message && data.message.result && data.message.result.errata_count > 0) {
            const result = data.message.result;
            if (result.html !== result.notag_html) {
              errors.push({ original: text, correct: result.notag_html, help: `${result.errata_count}ê°œ ì˜¤ë¥˜ ë°œê²¬` });
            }
          }
        } catch (e) { console.error('ë§ì¶¤ë²• ê²€ì‚¬ ì˜¤ë¥˜:', e); }
      }
      const uniqueErrors = errors.filter((err, idx, self) =>
        idx === self.findIndex(e => e.original === err.original && e.correct === err.correct)
      ).filter(err => err.original !== err.correct);
      parent.postMessage({ pluginMessage: { type: 'spell-check-response', errors: uniqueErrors } }, '*');
    }

    // ===== Data Fill íƒ­ =====
    // Google Sheets ì„¤ì •
    const SHEET_ID = '1GxYVsB6zmrp9bwhm_MjY-a8QQLolk0O1XjqpYPwkJXc';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    // ê¸°ë³¸ ë”ë¯¸ ë°ì´í„° (Google Sheets ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©)
    // ì‹œíŠ¸ êµ¬ì¡°: ê° ì—´ì´ í•„ë“œëª…, ê° í–‰ì´ ë°ì´í„°
    let dummyData = {
      creator: [
        { name: 'Name', desc: 'í¬ë¦¬ì—ì´í„° ì´ë¦„', values: [
          'Fairy ç¦¹éœ@170 Beauty', 'æœ±é‡Œï½»ï¾ğŸ‡¯ğŸ‡µ-shurisama-', 'ãƒŠãƒ„ãƒŸã‚·ãƒ£ãƒˆãƒ³ãƒŒğŸ‡¯ğŸ‡µ', 'Babe Bella Lynn', 'sulittleliè˜‡å°ç«‹â¤ï¸',
          'ë‰´íŠ¸ëŸ´ë§¤ê±°ì§„ Neutral Mag', 'ì„œí•˜ SEOHAğŸª„ğŸª½ğŸ°', 'ì§€ì•„ğŸŒ¸apple ziağŸğŸŒ¸', 'ğŸ£ë ˆì´ì‹±ëª¨ë¸ë¯¼ìœ ì•„ğŸ£', 'ì´ì•„ì´ì˜¬ì‹œë‹¤ğŸ˜ˆ',
          'ë§ˆë£¨ì—ëª½', 'ì†œì´', 'soi', 'SuminğŸ­', 'í•˜ì•™ ğŸ«¦ í•˜ì˜',
          'ì–‘ì´', 'Mikoâ¤ï¸', 'ê½ì£¼', 'Mana', 'è±¬è’‚ Judy', 'MOEILIN ğŸˆâ€â¬›'
        ] },
        { name: 'Handle', desc: '@í•¸ë“¤', values: [
          '@z_fk_z', '@shurisama', '@natsumiokinawa', '@babebellalynn', '@sulittleli',
          '@neutralmagazine', '@seoha_official', '@apple_zia', '@minyua_racing', '@iaiolsida',
          '@maruemong', '@som2', '@soi_official', '@sumin_mouse', '@hayang_ha',
          '@yang2', '@miko_heart', '@kkongju', '@mana_official', '@judy_pig', '@moeilin'
        ] },
        { name: 'Avatar', desc: 'í”„ë¡œí•„ ì´ë¯¸ì§€', values: [] },
        { name: 'FollowersText', desc: 'íŒ”ë¡œì›Œ ìˆ˜', values: [
          '17.8K', '6.8K', '6.8K', '104.6K', '7.8K', '15.2K', '23.1K', '8.9K', '12.4K', '5.6K',
          '45.3K', '18.7K', '9.2K', '11.5K', '7.3K', '4.8K', '22.1K', '6.1K', '8.4K', '13.9K', '257K'
        ] },
        { name: 'PostsText', desc: 'í¬ìŠ¤íŠ¸ ìˆ˜', values: [
          '467', '78', '214', '40', '276', '523', '189', '342', '156', '87',
          '421', '234', '167', '298', '145', '112', '387', '93', '256', '178', '758'
        ] },
        { name: 'BioText', desc: 'ì†Œê°œê¸€', values: [
          'A Taiwanese model with beautiful legs', 'é¶´è–—æœ±é‡Œå¶(ä¼‘æ­¢ä¸­...)', 'æ—¥æœ¬ğŸ‡¯ğŸ‡µ ã§æ´»å‹•ä¸­', 'Ur little Canadian Naughty Girl', 'å°ç«‹çš„ç¨å®¶ç…§ç‰‡åªæœ‰åœ¨é€™çœ‹å¾—åˆ°',
          'íŒ¨ì…˜ & ë¼ì´í”„ìŠ¤íƒ€ì¼ ë§¤ê±°ì§„', 'ëª¨ë¸ ì„œí•˜ì…ë‹ˆë‹¤ ğŸ’•', 'ì‚¬ê³¼ì²˜ëŸ¼ ìƒí¼í•˜ê²Œ ğŸ', 'ë ˆì´ì‹±ëª¨ë¸ ë¯¼ìœ ì•„', 'ì´ì•„ì´ì˜¬ì‹œë‹¤ ê³µì‹',
          'ë§ˆë£¨ì—ëª½ì´ì—ìš”~', 'ì†œì´ì˜ ì¼ìƒ', 'soi ì…ë‹ˆë‹¤', 'ìˆ˜ë¯¼ì´ì˜ í•˜ë£¨', 'í•˜ì˜ì´ì—ìš” ğŸ«¦',
          'ì–‘ì´ ê³µì‹ ê³„ì •', 'Miko ì…ë‹ˆë‹¤ â¤ï¸', 'ê½ì£¼ì˜ˆìš”~', 'Mana Official', 'Judy è±¬è’‚', 'MOEILIN Official ğŸˆâ€â¬›'
        ] }
      ],
      fan: [
        { name: 'Name', desc: 'íŒ¬ ì´ë¦„', values: [
          'yeony_babe', 'í‚¹ì• ë´‰', 'Sato Toshio', 'ì§€í›„', 'ì˜ˆì§„', 'Yamamoto Kenji', 'ë‹´ì—°',
          'ë´‰ì£¼ë¥´', 'ìŠˆê±°ë² ë² ', 'ë‹¬ë¹›ì†Œë‚˜íƒ€', 'í•˜ëŠ˜ë°”ë¼ê¸°', 'ê¿ˆê¾¸ëŠ”ì†Œë…€', 'Chen Wei', 'ë³„ë¹›ì²œì‚¬',
          'í–‰ë³µí•œí•˜ë£¨', 'Kim Minji', 'ì‚¬ë‘í•´ìš”', 'ì€í•˜ìˆ˜', 'ì´ˆì½”íŒŒì´', 'Lee Junho', 'ë¬´ì§€ê°œë¹›',
          'ë‹¬ì½¤í•œì¸ìƒ', 'í–‡ì‚´ê°€ë“', 'Park Sooyoung', 'ê½ƒë³´ë‹¤ì˜ˆìœ', 'ë°”ëŒì²˜ëŸ¼', 'êµ¬ë¦„ìœ„ì˜ì‚°ì±…',
          'Tanaka Yuki', 'ë³„ë˜¥ë³„', 'í–‰ìš´ì˜í´ë¡œë²„', 'ë‹¬ë¹›ìš”ì •', 'Wang Xiaoli', 'ì‚¬ë‘ìŠ¤ëŸ¬ìš´',
          'ê¿ˆì˜ë‚˜ë¼', 'í•´í”¼ë°”ì´ëŸ¬ìŠ¤', 'Suzuki Hana', 'ë³„ë¹›ì •ì›', 'ë‹¬ì½¤í•œì¶”ì–µ', 'ë¬´í•œë„ì „', 'í•˜íŠ¸ë¿…ë¿…'
        ] },
        { name: 'Handle', desc: '@í•¸ë“¤', values: [
          '@yeony_babe', '@kingaebong', '@sato_toshio', '@jihu_fan', '@yejin_star', '@yamamoto_k', '@damyeon',
          '@bonjour_fan', '@sugarbebe', '@moonlight_sonata', '@sky_watcher', '@dreaming_girl', '@chen_wei', '@starlight_angel',
          '@happy_day', '@kim_minji', '@saranghae', '@milkyway', '@choco_pie', '@lee_junho', '@rainbow_light',
          '@sweet_life', '@sunshine_full', '@park_sooyoung', '@prettier_flower', '@like_wind', '@cloud_walk',
          '@tanaka_yuki', '@shooting_star', '@lucky_clover', '@moonlight_fairy', '@wang_xiaoli', '@lovely_one',
          '@dreamland', '@happy_virus', '@suzuki_hana', '@starlight_garden', '@sweet_memory', '@infinite_challenge', '@heart_bbyong'
        ] },
        { name: 'Avatar', desc: 'í”„ë¡œí•„ ì´ë¯¸ì§€', values: [] },
        { name: 'Comment', desc: 'ëŒ“ê¸€', values: [
          'ìƒì¶•ğŸ‰', 'ì–¸ë‹ˆ ìƒì¼ ì¶•í•˜í•´ğŸ‚', 'ãŠèª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ğŸ‰', 'ë‹¤ë¦¬ ì§„ì§œ ì˜ˆë»ìš”ğŸ˜', 'ìµœê³ ì˜ íŒ¬ì´ì—ìš”ğŸ’•',
          'å¿œæ´ã—ã¦ã¾ã™ï¼', 'ë©¤ë²„ì‹­ ê°€ì…í–ˆì–´ìš”!', 'ì˜¤ëŠ˜ë„ ì˜ˆì˜ë„¤ìš”âœ¨', 'í•­ìƒ ì‘ì›í•©ë‹ˆë‹¤ğŸ’ª', 'ì‚¬ë‘í•´ìš”â¤ï¸',
          'æ–°ã—ã„æŠ•ç¨¿å¾…ã£ã¦ã¾ã™', 'ë„ˆë¬´ ì¢‹ì•„ìš”ğŸ‘', 'íŒ¬ë¯¸íŒ… ì–¸ì œí•´ìš”?', 'ìµœì• ì…ë‹ˆë‹¤ğŸ¥°', 'í–‰ë³µí•˜ì„¸ìš”ğŸ’–',
          'ãƒ•ã‚¡ãƒ³ã§ã™ï¼', 'ì˜ˆìœ ì‚¬ì§„ ê°ì‚¬í•´ìš”ğŸ“¸', 'ì˜¤ëŠ˜ í•˜ë£¨ë„ í™”ì´íŒ…!', 'ì§„ì§œ ëŒ€ë°•ì´ì—ìš”ğŸ”¥', 'ì‚¬ë‘í•©ë‹ˆë‹¤ğŸ’—',
          'ç´ æ•µã§ã™âœ¨', 'íŒ¬ì´ ëœì§€ 1ë…„ì§¸!', 'í•­ìƒ í–‰ë³µí•˜ì„¸ìš”ğŸ˜Š', 'ìµœê³ ì˜ˆìš”ğŸ‘‘', 'ì‘ì›í•´ìš”ğŸ“£',
          'ã„ã¤ã‚‚è¦‹ã¦ã¾ã™', 'ë„ˆë¬´ ê·€ì—¬ì›Œìš”ğŸ°', 'ë©‹ì ¸ìš”ğŸ’¯', 'íŒ¬ì‹¬ í­ë°œğŸ’¥', 'ì‚¬ë‘í•´ìš©ğŸ’•',
          'é ‘å¼µã£ã¦ãã ã•ã„', 'ì˜ˆì¨ ì£¼ì˜ë³´âš ï¸', 'ìµœì•  ì¤‘ì˜ ìµœì• ğŸ’', 'í–‰ë³µ ë°”ì´ëŸ¬ìŠ¤ğŸ¦ ', 'íŒ¬ì´ì—ìš”!',
          'å¤§å¥½ãã§ã™', 'ì˜¤ëŠ˜ë„ ë¹›ë‚˜ë„¤ìš”â­', 'ì‚¬ë‘ìŠ¤ëŸ¬ì›Œìš”ğŸ’', 'íŒ¬ 1í˜¸ì…ë‹ˆë‹¤ğŸ†', 'í•­ìƒ ê°ì‚¬í•´ìš”ğŸ™'
        ] }
      ]
    };

    let isDataLoaded = false;

    // Google Sheetsì—ì„œ íŠ¹ì • ì‹œíŠ¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadSheetData(sheetName) {
      try {
        const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(sheetName)}`;
        const response = await fetch(url);
        const text = await response.text();

        const jsonString = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*?)\);/);
        if (!jsonString || !jsonString[1]) {
          console.error(`${sheetName} ì‹œíŠ¸ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨`);
          return [];
        }

        const json = JSON.parse(jsonString[1]);
        const table = json.table;
        const result = [];

        const headers = table.cols.map(col => col.label || '');
        headers.forEach((header, colIdx) => {
          if (!header) return;

          const values = [];
          table.rows.forEach(row => {
            const cell = row.c[colIdx];
            if (cell && cell.v) {
              values.push(String(cell.v));
            }
          });

          if (values.length > 0) {
            result.push({ name: header, desc: header, values: values });
          }
        });

        return result;
      } catch (error) {
        console.error(`${sheetName} ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨:`, error);
        return [];
      }
    }

    // Google Sheetsì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (í¬ë¦¬ì—ì´í„° + íŒ¬)
    async function loadGoogleSheetsData() {
      try {
        console.log('Google Sheets ë°ì´í„° ë¡œë”© ì¤‘...');

        // í¬ë¦¬ì—ì´í„° ì‹œíŠ¸ ë¡œë“œ
        const creatorData = await loadSheetData('í¬ë¦¬ì—ì´í„°');
        // íŒ¬ ì‹œíŠ¸ ë¡œë“œ
        const fanData = await loadSheetData('íŒ¬');

        const newData = {
          creator: creatorData.length > 0 ? creatorData : null,
          fan: fanData.length > 0 ? fanData : null
        };

        console.log('Google Sheets ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', newData);
        return newData;
      } catch (error) {
        console.error('Google Sheets ë¡œë“œ ì‹¤íŒ¨:', error);
        return null;
      }
    }

    // í”ŒëŸ¬ê·¸ì¸ ì‹œì‘ ì‹œ Google Sheets ë°ì´í„° ë¡œë“œ
    async function initializeData() {
      console.log('initializeData ì‹œì‘');
      const sheetsData = await loadGoogleSheetsData();

      // í¬ë¦¬ì—ì´í„° ë°ì´í„° ì—…ë°ì´íŠ¸
      if (sheetsData && sheetsData.creator && sheetsData.creator.length > 0) {
        dummyData.creator = sheetsData.creator;
        console.log('í¬ë¦¬ì—ì´í„° ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ, ê°œìˆ˜:', dummyData.creator[0].values.length);
      } else {
        console.log('í¬ë¦¬ì—ì´í„° ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©');
      }

      // íŒ¬ ë°ì´í„° ì—…ë°ì´íŠ¸
      if (sheetsData && sheetsData.fan && sheetsData.fan.length > 0) {
        dummyData.fan = sheetsData.fan;
        console.log('íŒ¬ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ, ê°œìˆ˜:', dummyData.fan[0].values.length);
      } else {
        console.log('íŒ¬ ì‹œíŠ¸ ë¡œë“œ ì‹¤íŒ¨, ê¸°ë³¸ ë°ì´í„° ì‚¬ìš©');
      }

      isDataLoaded = true;
      renderFields(currentCategory);
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë°ì´í„° ì´ˆê¸°í™”
    initializeData();

    let currentCategory = 'creator';
    let selectedField = null;
    const fieldList = document.getElementById('fieldList');
    const dataPreview = document.getElementById('dataPreview');
    const previewValue = document.getElementById('previewValue');
    const dataFillStatus = document.getElementById('dataFillStatus');

    // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updatePreview() {
      if (!selectedField) {
        dataPreview.style.display = 'none';
        return;
      }

      const fields = dummyData[currentCategory] || [];
      const field = fields.find(f => f.name === selectedField);
      if (!field || !field.values || field.values.length === 0) {
        dataPreview.style.display = 'none';
        return;
      }

      dataPreview.style.display = 'block';

      // ì¼ì¹˜í•˜ëŠ” ë ˆì´ì–´ ê°œìˆ˜ë§Œí¼ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ (ìµœëŒ€ 5ê°œ)
      const previewCount = Math.min(matchingLayerCount || 1, 5, field.values.length);
      const previewValues = field.values.slice(0, previewCount);

      if (matchingLayerCount > 0) {
        previewValue.innerHTML = previewValues.map((v, i) =>
          `<div style="padding: 4px 0; ${i > 0 ? 'border-top: 1px solid #E5E7EB;' : ''}">${i + 1}. ${v}</div>`
        ).join('') + (matchingLayerCount > 5 ? `<div style="color: #838499; padding-top: 4px;">... ì™¸ ${matchingLayerCount - 5}ê°œ</div>` : '');
      } else {
        previewValue.textContent = field.values[0];
      }
    }

    function renderFields(category) {
      const fields = dummyData[category] || [];
      if (fields.length === 0) {
        fieldList.innerHTML = '<div style="padding: 20px; color: #838499; text-align: center;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }
      fieldList.innerHTML = fields.map(field => `
        <div class="field-item" data-field="${field.name}">
          <div class="field-check"></div>
          <span class="field-name">${field.name}</span>
          <span class="field-desc">${field.desc}</span>
        </div>
      `).join('');

      fieldList.querySelectorAll('.field-item').forEach(item => {
        item.onclick = () => {
          // ì´ë¯¸ ì„ íƒëœ í•­ëª©ì„ ë‹¤ì‹œ í´ë¦­í•˜ë©´ ì„ íƒ í•´ì œ
          if (item.classList.contains('selected')) {
            item.classList.remove('selected');
            selectedField = null;
            dataPreview.style.display = 'none';
          } else {
            // ë‹¤ë¥¸ í•­ëª© ì„ íƒ
            fieldList.querySelectorAll('.field-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            selectedField = item.dataset.field;

            // ì„ íƒ ì‹œ Figmaì— ì¼ì¹˜í•˜ëŠ” ë ˆì´ì–´ ê°œìˆ˜ ìš”ì²­
            parent.postMessage({
              pluginMessage: { type: 'count-matching-layers', fieldName: selectedField }
            }, '*');

            // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ì¼ì¹˜í•˜ëŠ” ë ˆì´ì–´ ê°œìˆ˜ëŠ” Figmaì—ì„œ ì‘ë‹µë°›ìœ¼ë©´ ì—…ë°ì´íŠ¸ë¨)
            updatePreview();
          }
        };
      });
    }

    document.querySelectorAll('.category-tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentCategory = tab.dataset.category;
        selectedField = null;
        dataPreview.style.display = 'none';
        renderFields(currentCategory);
      };
    });

    function showDataFillStatus(message, type) {
      dataFillStatus.textContent = message;
      dataFillStatus.className = 'status show ' + type;
    }

    document.getElementById('applyDataBtn').onclick = () => {
      if (!selectedField) {
        showDataFillStatus('í•„ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
        return;
      }
      const field = dummyData[currentCategory].find(f => f.name === selectedField);
      if (field) {
        // ì´ë¯¸ì§€ íƒ€ì…ì¸ ê²½ìš°
        if (field.isImage) {
          showDataFillStatus('ì´ë¯¸ì§€ ë¡œë”© ì¤‘...', 'info');
          parent.postMessage({
            pluginMessage: { type: 'apply-image-fill', imageType: field.imageType }
          }, '*');
        } else {
          // í…ìŠ¤íŠ¸ íƒ€ì…ì¸ ê²½ìš°
          const randomValue = field.values[Math.floor(Math.random() * field.values.length)];
          showDataFillStatus('ì ìš© ì¤‘...', 'info');
          parent.postMessage({
            pluginMessage: { type: 'apply-dummy-data', value: randomValue }
          }, '*');
        }
      }
    };

    document.getElementById('randomFillBtn').onclick = () => {
      showDataFillStatus('ëœë¤ ì±„ìš°ê¸° ì¤‘...', 'info');
      parent.postMessage({
        pluginMessage: { type: 'random-fill', category: currentCategory, data: dummyData[currentCategory] }
      }, '*');
    };

    // ì´ˆê¸° ë Œë”ë§
    renderFields('creator');

    // ===== Compare íƒ­ =====
    let compareSource = 'paste';
    const compareResults = document.getElementById('compareResults');
    const compareStatus = document.getElementById('compareStatus');
    const compareSummary = document.getElementById('compareSummary');

    // ì†ŒìŠ¤ íƒ­ ì „í™˜
    document.querySelectorAll('.compare-source-tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelectorAll('.compare-source-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        compareSource = tab.dataset.source;

        // ì…ë ¥ ì„¹ì…˜ ì „í™˜
        document.getElementById('pasteInputSection').style.display = compareSource === 'paste' ? 'block' : 'none';
        document.getElementById('notionUrlSection').style.display = compareSource === 'notion' ? 'block' : 'none';
      };
    });

    function showCompareStatus(message, type) {
      compareStatus.textContent = message;
      compareStatus.className = 'status show ' + type;
    }

    // ë¹„êµ ë²„íŠ¼
    document.getElementById('compareBtn').onclick = () => {
      let notionText = '';

      if (compareSource === 'paste') {
        notionText = document.getElementById('notionContent').value.trim();
      } else {
        // Notion API ì—°ë™ (ì¶”í›„ êµ¬í˜„)
        const pageId = document.getElementById('notionPageId').value.trim();
        if (!pageId) {
          showCompareStatus('Notion í˜ì´ì§€ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
          return;
        }
        // Notion APIë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        fetchNotionPage(pageId);
        return;
      }

      if (!notionText) {
        showCompareStatus('ë¹„êµí•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      showCompareStatus('ë¹„êµ ì¤‘...', 'info');
      compareResults.innerHTML = `
        <div class="checker-loading">
          <div class="checker-spinner"></div>
          <div>Figma í…ìŠ¤íŠ¸ì™€ ë¹„êµ ì¤‘...</div>
        </div>
      `;

      // Figmaì— ë¹„êµ ìš”ì²­
      parent.postMessage({
        pluginMessage: { type: 'compare-with-notion', notionText: notionText }
      }, '*');
    };

    // Notion APIë¡œ í˜ì´ì§€ ê°€ì ¸ì˜¤ê¸°
    async function fetchNotionPage(pageId) {
      showCompareStatus('Notion í˜ì´ì§€ ë¡œë”© ì¤‘...', 'info');

      // Notion APIëŠ” ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ ê°€ëŠ¥í•˜ë¯€ë¡œ, í˜„ì¬ëŠ” ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
      showCompareStatus('Notion API ì—°ë™ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. ì§ì ‘ ì…ë ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.', 'info');
    }

    // ë¹„êµ ê²°ê³¼ ë Œë”ë§
    function renderCompareResults(results) {
      if (!results || results.length === 0) {
        compareResults.innerHTML = `
          <div class="checker-empty">
            <div class="checker-empty-icon">ğŸ¤”</div>
            <div class="checker-empty-text">ë¹„êµí•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤</div>
            <div class="checker-empty-subtext">Figmaì—ì„œ ë ˆì´ì–´ë¥¼ ì„ íƒí•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”</div>
          </div>
        `;
        compareSummary.style.display = 'none';
        return;
      }

      // í†µê³„ ê³„ì‚°
      const matchCount = results.filter(r => r.status === 'match').length;
      const mismatchCount = results.filter(r => r.status === 'mismatch').length;
      const missingCount = results.filter(r => r.status === 'missing').length;

      // ìš”ì•½ í‘œì‹œ
      compareSummary.style.display = 'flex';
      document.getElementById('matchCount').textContent = matchCount;
      document.getElementById('mismatchCount').textContent = mismatchCount;
      document.getElementById('missingCount').textContent = missingCount;

      // ê²°ê³¼ ëª©ë¡ (ë¶ˆì¼ì¹˜/ëˆ„ë½ ìš°ì„  í‘œì‹œ)
      const sortedResults = [...results].sort((a, b) => {
        const order = { mismatch: 0, missing: 1, match: 2 };
        return order[a.status] - order[b.status];
      });

      compareResults.innerHTML = sortedResults.map(item => `
        <div class="compare-item ${item.status}" data-node-id="${item.nodeId || ''}">
          <div class="compare-item-icon">
            ${item.status === 'match' ? 'âœ…' : item.status === 'mismatch' ? 'âŒ' : 'âš ï¸'}
          </div>
          <div class="compare-item-content">
            <div class="compare-item-label">${item.label || 'í…ìŠ¤íŠ¸'}</div>
            <div class="compare-item-text">${item.status === 'missing' ? item.expected : item.actual}</div>
            ${item.status === 'mismatch' ? `
              <div class="compare-item-diff">
                <div class="compare-item-expected">ê¸°íš: ${item.expected}</div>
                <div class="compare-item-actual">ë””ìì¸: ${item.actual}</div>
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');

      // í´ë¦­ ì‹œ í•´ë‹¹ ë…¸ë“œ ì„ íƒ
      compareResults.querySelectorAll('.compare-item').forEach(item => {
        item.onclick = () => {
          const nodeId = item.dataset.nodeId;
          if (nodeId) {
            parent.postMessage({
              pluginMessage: { type: 'select-node', nodeId: nodeId }
            }, '*');
          }
        };
      });
    }

    // ===== Code2Design íƒ­ =====
    const codeInput = document.getElementById('codeInput');
    const codePreview = document.getElementById('codePreview');
    const codePreviewInfo = document.getElementById('codePreviewInfo');

    // ì½”ë“œ íƒ€ì… ì„ íƒ í•¨ìˆ˜ (ì¸ë¼ì¸ onclickì—ì„œ í˜¸ì¶œ)
    function selectCodeType(btn, codeType) {
      document.querySelectorAll('.code-type-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      currentCodeType = codeType;
      console.log('ì½”ë“œ íƒ€ì… ë³€ê²½:', currentCodeType);
    }

    // React ì½”ë“œ íŒŒì‹±
    function parseReactCode(code) {
      const elements = [];

      // CSS ìŠ¤íƒ€ì¼ ì¶”ì¶œ (/* CSS */ ë˜ëŠ” .css íŒŒì¼ ë‚´ìš©)
      const cssStyles = {};
      const cssRegex = /\.([a-zA-Z0-9_-]+)\s*\{([^}]+)\}/g;
      let cssMatch;
      while ((cssMatch = cssRegex.exec(code)) !== null) {
        const className = cssMatch[1];
        const styles = cssMatch[2];
        cssStyles[className] = parseInlineStyles(styles);
      }

      // JSX ìš”ì†Œ íŒŒì‹±
      const jsxRegex = /<(\w+)([^>]*)>([^<]*)<\/\1>|<(\w+)([^>]*)\/>/g;
      let match;

      // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ ê°ì²´ íŒŒì‹±
      const styleObjectRegex = /style=\{\{([^}]+)\}\}/g;
      const classNameRegex = /className="([^"]+)"/;

      // rows ë°°ì—´ ë°ì´í„° ì¶”ì¶œ (TextStyleGuide ê°™ì€ ì»´í¬ë„ŒíŠ¸ìš©)
      const rowsMatch = code.match(/const rows[^=]*=\s*\[([\s\S]*?)\];/);
      if (rowsMatch) {
        const rowsContent = rowsMatch[1];
        const rowRegex = /\{[^{]*style:\s*"([^"]+)"[^{]*sample:\s*"([^"]+)"[^{]*spec:\s*"([^"]+)"[^{]*sampleStyle:\s*\{([^}]+)\}[^}]*\}/g;
        let rowMatch;
        while ((rowMatch = rowRegex.exec(rowsContent)) !== null) {
          elements.push({
            type: 'text-row',
            styleName: rowMatch[1],
            sample: rowMatch[2],
            spec: rowMatch[3],
            sampleStyle: parseInlineStyles(rowMatch[4])
          });
        }
      }

      // í—¤ë” ì¶”ì¶œ
      const headerH1 = code.match(/<h1[^>]*>([^<]+)<\/h1>/);
      const headerP = code.match(/<p[^>]*>([^<]+)<\/p>/);
      if (headerH1) {
        elements.push({ type: 'header', title: headerH1[1], subtitle: headerP ? headerP[1] : '' });
      }

      return { elements, cssStyles };
    }

    // ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ íŒŒì‹±
    function parseInlineStyles(styleStr) {
      const styles = {};
      const pairs = styleStr.split(/,\s*(?![^(]*\))/);

      pairs.forEach(pair => {
        const colonIndex = pair.indexOf(':');
        if (colonIndex > -1) {
          let key = pair.substring(0, colonIndex).trim();
          let value = pair.substring(colonIndex + 1).trim();

          // camelCaseë¥¼ kebab-caseë¡œ ë³€í™˜
          key = key.replace(/([A-Z])/g, '-$1').toLowerCase();

          // ë”°ì˜´í‘œ ì œê±°
          value = value.replace(/['"]/g, '');

          styles[key] = value;
        }
      });

      return styles;
    }

    // ë””ìì¸ ìƒì„± í•¨ìˆ˜ (ì „ì—­)
    function generateDesign() {
      console.log('generateDesign í˜¸ì¶œë¨');

      const btn = document.getElementById('generateDesignBtn');
      const codeEl = document.getElementById('codeInput');
      const code = codeEl ? codeEl.value.trim() : '';

      if (!code) {
        showCode2DesignStatus('ì½”ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      // ë¡œë”© ì‹œì‘
      console.log('ë¡œë”© ì‹œì‘');
      if (btn) btn.classList.add('loading');
      showCode2DesignStatus('ì½”ë“œ ë¶„ì„ ì¤‘...', 'info');

      try {
        const parsed = parseReactCode(code);
        console.log('íŒŒì‹± ì™„ë£Œ:', parsed);

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        const preview = document.getElementById('codePreview');
        const previewInfo = document.getElementById('codePreviewInfo');
        if (preview) preview.style.display = 'block';
        if (previewInfo) {
          previewInfo.innerHTML = `
            <div>ë°œê²¬ëœ ìš”ì†Œ: ${parsed.elements.length}ê°œ</div>
            <div>CSS í´ë˜ìŠ¤: ${Object.keys(parsed.cssStyles).length}ê°œ</div>
          `;
        }

        // Figmaì— ë””ìì¸ ìƒì„± ìš”ì²­
        console.log('Figmaì— ë©”ì‹œì§€ ì „ì†¡');
        parent.postMessage({
          pluginMessage: {
            type: 'generate-from-code',
            codeType: currentCodeType,
            parsed: parsed,
            rawCode: code
          }
        }, '*');

      } catch (e) {
        console.error('íŒŒì‹± ì—ëŸ¬:', e);
        if (btn) btn.classList.remove('loading');
        showCode2DesignStatus('ì½”ë“œ íŒŒì‹± ì‹¤íŒ¨: ' + e.message, 'error');
      }
    }

    // ===== .pen íŒŒì¼ ì—…ë¡œë“œ =====
    let penDocumentData = null; // íŒŒì‹±ëœ .pen ë¬¸ì„œ ì „ì²´

    const penFileInput = document.getElementById('penFileInput');
    const penDropzone = document.getElementById('penDropzone');

    // íŒŒì¼ input ë³€ê²½ ì´ë²¤íŠ¸
    penFileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) loadPenFile(file);
    });

    // ë“œë˜ê·¸&ë“œë¡­ ì´ë²¤íŠ¸
    penDropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      penDropzone.classList.add('drag-over');
    });
    penDropzone.addEventListener('dragleave', () => {
      penDropzone.classList.remove('drag-over');
    });
    penDropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      penDropzone.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      if (file && file.name.endsWith('.pen')) {
        loadPenFile(file);
      } else {
        showPenStatus('.pen íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤', 'error');
      }
    });

    function loadPenFile(file) {
      // ì¦‰ì‹œ ë¡œë”© ìƒíƒœ í‘œì‹œ
      showPenStatus('íŒŒì¼ ì½ëŠ” ì¤‘...', 'info');
      document.getElementById('penDropzone').style.display = 'none';

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          penDocumentData = JSON.parse(e.target.result);
          displayPenFile(file.name, penDocumentData);
        } catch (err) {
          document.getElementById('penDropzone').style.display = '';
          showPenStatus('.pen íŒŒì¼ íŒŒì‹± ì‹¤íŒ¨: ' + err.message, 'error');
        }
      };
      reader.onerror = function() {
        document.getElementById('penDropzone').style.display = '';
        showPenStatus('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'error');
      };
      reader.readAsText(file);
    }

    function displayPenFile(fileName, doc) {
      // ìµœìƒìœ„ children ì¤‘ frame íƒ€ì…ë§Œ ìˆ˜ì§‘
      const frames = (doc.children || []).filter(function(n) { return n.type === 'frame'; });

      document.getElementById('penFileName').textContent = fileName;
      document.getElementById('penFileMeta').textContent = frames.length + 'ê°œ í”„ë ˆì„ Â· ' + (doc.variables ? Object.keys(doc.variables).length : 0) + 'ê°œ ë³€ìˆ˜';
      document.getElementById('penFileInfo').classList.add('show');
      document.getElementById('penConvertStatus').className = 'status'; // ë¡œë”© ë©”ì‹œì§€ ì œê±°

      // í”„ë ˆì„ ëª©ë¡ ë Œë”ë§
      const listEl = document.getElementById('penFrameList');
      listEl.innerHTML = '';
      frames.forEach(function(frame, idx) {
        const w = Math.round(frame.width || 0);
        const h = frame.height ? Math.round(frame.height) + '' : 'auto';
        const item = document.createElement('div');
        item.className = 'pen-frame-item';
        item.innerHTML =
          '<input type="checkbox" id="penFrame_' + idx + '" checked data-idx="' + idx + '">' +
          '<label for="penFrame_' + idx + '" class="pen-frame-item-name">' + (frame.name || ('í”„ë ˆì„ ' + (idx+1))) + '</label>' +
          '<span class="pen-frame-item-size">' + w + 'Ã—' + h + '</span>';
        listEl.appendChild(item);
      });

      if (frames.length > 0) {
        listEl.classList.add('show');
        document.getElementById('convertPenBtn').style.display = 'flex';
      } else {
        showPenStatus('ë³€í™˜ ê°€ëŠ¥í•œ í”„ë ˆì„ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
      }
    }

    function clearPenFile() {
      penDocumentData = null;
      penFileInput.value = '';
      document.getElementById('penFileInfo').classList.remove('show');
      document.getElementById('penFrameList').classList.remove('show');
      document.getElementById('penDropzone').style.display = '';
      document.getElementById('convertPenBtn').style.display = 'none';
      document.getElementById('penProgress').style.display = 'none';
      document.getElementById('penConvertStatus').className = 'status';
    }

    function showPenStatus(message, type) {
      const el = document.getElementById('penConvertStatus');
      if (el) {
        el.textContent = message;
        el.className = 'status show ' + type;
      }
    }

    function convertPenFrames() {
      if (!penDocumentData) {
        showPenStatus('.pen íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”', 'error');
        return;
      }

      // ì„ íƒëœ í”„ë ˆì„ë§Œ ìˆ˜ì§‘
      const allFrames = (penDocumentData.children || []).filter(function(n) { return n.type === 'frame'; });
      const checkboxes = document.querySelectorAll('#penFrameList input[type="checkbox"]');
      const selectedFrames = [];
      checkboxes.forEach(function(cb) {
        if (cb.checked) {
          const idx = parseInt(cb.dataset.idx);
          if (allFrames[idx]) selectedFrames.push(allFrames[idx]);
        }
      });

      if (selectedFrames.length === 0) {
        showPenStatus('ë³€í™˜í•  í”„ë ˆì„ì„ ì„ íƒí•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      // ì§„í–‰ ë°” ì´ˆê¸°í™”
      const progressEl = document.getElementById('penProgress');
      const barEl = document.getElementById('penProgressBar');
      const labelEl = document.getElementById('penProgressLabel');
      const nameEl = document.getElementById('penProgressName');
      if (progressEl) progressEl.style.display = 'block';
      if (barEl) barEl.style.width = '0%';
      if (labelEl) labelEl.textContent = 'ë³€í™˜ ì‹œì‘ ì¤‘...';
      if (nameEl) nameEl.textContent = '';

      const btn = document.getElementById('convertPenBtn');
      if (btn) btn.classList.add('loading');
      document.getElementById('penConvertStatus').className = 'status';

      parent.postMessage({
        pluginMessage: {
          type: 'convert-pen-frames',
          frames: selectedFrames,
          variables: penDocumentData.variables || {}
        }
      }, '*');
    }

    // ===== Variables íƒ­ =====
    function selectVariableType(btn, type) {
      document.querySelectorAll('.variable-type-tab').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
      currentVariableType = type;
    }

    function showVariablesStatus(message, type) {
      const statusEl = document.getElementById('variablesStatus');
      if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = 'status show ' + type;
      }
    }

    function detectValueType(value) {
      // ìƒ‰ìƒ ê°ì§€
      if (typeof value === 'string') {
        // HEX ìƒ‰ìƒ
        if (/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}|[A-Fa-f0-9]{8})$/.test(value)) {
          return 'color';
        }
        // rgb/rgba
        if (/^rgba?\s*\(/.test(value)) {
          return 'color';
        }
        // hsl/hsla
        if (/^hsla?\s*\(/.test(value)) {
          return 'color';
        }
      }
      // ìˆ«ì ê°ì§€
      if (typeof value === 'number') {
        return 'number';
      }
      if (typeof value === 'string' && /^-?\d+(\.\d+)?$/.test(value)) {
        return 'number';
      }
      // ë‚˜ë¨¸ì§€ëŠ” ë¬¸ìì—´
      return 'string';
    }

    function parseJsonTokens(jsonStr) {
      try {
        const data = JSON.parse(jsonStr);
        const tokens = [];

        for (const [name, value] of Object.entries(data)) {
          let type = currentVariableType;
          if (type === 'auto') {
            type = detectValueType(value);
          }
          tokens.push({ name, value, type });
        }

        return tokens;
      } catch (e) {
        throw new Error('JSON íŒŒì‹± ì‹¤íŒ¨: ' + e.message);
      }
    }

    function previewVariables() {
      const jsonInput = document.getElementById('variableJsonInput');
      const previewEl = document.getElementById('variablePreview');
      const listEl = document.getElementById('variablePreviewList');

      if (!jsonInput || !jsonInput.value.trim()) {
        showVariablesStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      try {
        const tokens = parseJsonTokens(jsonInput.value);

        if (tokens.length === 0) {
          showVariablesStatus('í† í°ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }

        // ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
        previewEl.style.display = 'block';
        listEl.innerHTML = tokens.map(token => {
          const colorSwatch = token.type === 'color'
            ? `<div class="variable-color-swatch" style="background: ${token.value};"></div>`
            : '';
          return `
            <div class="variable-preview-item">
              ${colorSwatch}
              <span class="variable-name">${token.name}</span>
              <span class="variable-type-badge ${token.type}">${token.type}</span>
              <span class="variable-value">${token.value}</span>
            </div>
          `;
        }).join('');

        showVariablesStatus(`${tokens.length}ê°œ í† í° ê°ì§€ë¨`, 'success');

      } catch (e) {
        showVariablesStatus(e.message, 'error');
      }
    }

    function createVariables() {
      const btn = document.getElementById('createVariablesBtn');
      const jsonInput = document.getElementById('variableJsonInput');
      const collectionName = document.getElementById('collectionName');

      if (!jsonInput || !jsonInput.value.trim()) {
        showVariablesStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      try {
        const tokens = parseJsonTokens(jsonInput.value);

        if (tokens.length === 0) {
          showVariablesStatus('í† í°ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }

        // ë¡œë”© ì‹œì‘
        if (btn) btn.classList.add('loading');
        showVariablesStatus('ë² ë¦¬ì–´ë¸” ìƒì„± ì¤‘...', 'info');

        // Figmaì— ë©”ì‹œì§€ ì „ì†¡
        parent.postMessage({
          pluginMessage: {
            type: 'create-variables',
            collectionName: collectionName ? collectionName.value : 'Design Tokens',
            tokens: tokens
          }
        }, '*');

      } catch (e) {
        if (btn) btn.classList.remove('loading');
        showVariablesStatus(e.message, 'error');
      }
    }

    function createTextStyles() {
      const btn = document.getElementById('createTextStylesBtn');
      const jsonInput = document.getElementById('variableJsonInput');

      if (!jsonInput || !jsonInput.value.trim()) {
        showVariablesStatus('JSONì„ ì…ë ¥í•´ì£¼ì„¸ìš”', 'error');
        return;
      }

      try {
        // Text StylesëŠ” ë°°ì—´ í˜•ì‹ìœ¼ë¡œ íŒŒì‹±
        const data = JSON.parse(jsonInput.value);
        let tokens = [];

        if (Array.isArray(data)) {
          // ë°°ì—´ í˜•ì‹: [{name, fontFamily, fontSize, ...}, ...]
          tokens = data;
        } else {
          // ê°ì²´ í˜•ì‹: {"name": {...}} ë˜ëŠ” flat í˜•ì‹
          showVariablesStatus('Text StylesëŠ” ë°°ì—´ í˜•ì‹ JSONì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆì‹œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.', 'error');
          return;
        }

        if (tokens.length === 0) {
          showVariablesStatus('í† í°ì´ ì—†ìŠµë‹ˆë‹¤', 'error');
          return;
        }

        // ë¡œë”© ì‹œì‘
        if (btn) btn.classList.add('loading');
        showVariablesStatus('í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ìƒì„± ì¤‘...', 'info');

        // Figmaì— ë©”ì‹œì§€ ì „ì†¡
        parent.postMessage({
          pluginMessage: {
            type: 'create-text-styles',
            tokens: tokens
          }
        }, '*');

      } catch (e) {
        if (btn) btn.classList.remove('loading');
        showVariablesStatus('JSON íŒŒì‹± ì‹¤íŒ¨: ' + e.message, 'error');
      }
    }

    // ===== Checker íƒ­ =====
    let currentCheckerType = 'component';
    let checkerResults = { component: [], variable: [], textstyle: [] };
    const checkerResultsEl = document.getElementById('checkerResults');
    const checkerStatus = document.getElementById('checkerStatus');

    // ì²´ì»¤ íƒ­ ì „í™˜
    document.querySelectorAll('.checker-tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelectorAll('.checker-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentCheckerType = tab.dataset.checker;
        renderCheckerResults();
      };
    });

    function showCheckerStatus(message, type) {
      checkerStatus.textContent = message;
      checkerStatus.className = 'status show ' + type;
    }

    function updateCheckerSummary(total, errors, success) {
      document.querySelector('#summaryTotal .summary-number').textContent = total;
      document.querySelector('#summaryError .summary-number').textContent = errors;
      document.querySelector('#summarySuccess .summary-number').textContent = success;
    }

    function renderCheckerResults() {
      const results = checkerResults[currentCheckerType] || [];

      if (results.length === 0) {
        checkerResultsEl.innerHTML = `
          <div class="checker-empty">
            <div class="checker-empty-icon">âœ…</div>
            <div class="checker-empty-text">ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</div>
            <div class="checker-empty-subtext">ëª¨ë“  ë ˆì´ì–´ì— ë””ìì¸ ì‹œìŠ¤í…œì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤</div>
          </div>
        `;
        updateCheckerSummary('-', '-', '-');
        return;
      }

      // ìš”ì•½ ì—…ë°ì´íŠ¸
      const total = results.length;
      const errors = results.filter(r => !r.isApplied).length;
      const success = results.filter(r => r.isApplied).length;
      updateCheckerSummary(total, errors, success);

      // ë¯¸ì ìš© ë ˆì´ì–´ë§Œ í‘œì‹œ
      const errorItems = results.filter(r => !r.isApplied);

      if (errorItems.length === 0) {
        checkerResultsEl.innerHTML = `
          <div class="checker-empty">
            <div class="checker-empty-icon">âœ…</div>
            <div class="checker-empty-text">ëª¨ë‘ ì ìš©ë¨!</div>
            <div class="checker-empty-subtext">ì„ íƒí•œ ë ˆì´ì–´ì— ëª¨ë‘ ë””ìì¸ ì‹œìŠ¤í…œì´ ì ìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤</div>
          </div>
        `;
        return;
      }

      checkerResultsEl.innerHTML = errorItems.map(item => `
        <div class="checker-item ${item.severity === 'warning' ? 'warning' : ''}" data-node-id="${item.nodeId}">
          <div class="checker-item-icon">
            ${getCheckerIcon(item.type)}
          </div>
          <div class="checker-item-info">
            <div class="checker-item-name">${item.name}</div>
            <div class="checker-item-detail">${item.detail}</div>
          </div>
          <div class="checker-item-badge">${item.badge}</div>
        </div>
      `).join('');

      // í´ë¦­ ì‹œ í•´ë‹¹ ë…¸ë“œ ì„ íƒ
      checkerResultsEl.querySelectorAll('.checker-item').forEach(item => {
        item.onclick = () => {
          const nodeId = item.dataset.nodeId;
          parent.postMessage({
            pluginMessage: { type: 'select-node', nodeId: nodeId }
          }, '*');
        };
      });
    }

    function getCheckerIcon(type) {
      switch(type) {
        case 'component':
          return '<svg viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>';
        case 'variable':
          return '<svg viewBox="0 0 24 24" fill="none" stroke="#D97706" stroke-width="2"><circle cx="12" cy="12" r="9"/><path d="M12 8v8m-4-4h8"/></svg>';
        case 'textstyle':
          return '<svg viewBox="0 0 24 24" fill="none" stroke="#DC2626" stroke-width="2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>';
        default:
          return '';
      }
    }

    // ìŠ¤ìº” ë²„íŠ¼
    document.getElementById('scanDesignBtn').onclick = () => {
      showCheckerStatus('ìŠ¤ìº” ì¤‘...', 'info');
      checkerResultsEl.innerHTML = `
        <div class="checker-loading">
          <div class="checker-spinner"></div>
          <div>ë””ìì¸ ì‹œìŠ¤í…œ ê²€ì‚¬ ì¤‘...</div>
        </div>
      `;
      parent.postMessage({
        pluginMessage: { type: 'scan-design-system', checkerType: currentCheckerType }
      }, '*');
    };

    // ë¯¸ì ìš© ë ˆì´ì–´ ëª¨ë‘ ì„ íƒ ë²„íŠ¼
    document.getElementById('selectAllErrorsBtn').onclick = () => {
      const errorItems = (checkerResults[currentCheckerType] || []).filter(r => !r.isApplied);
      if (errorItems.length === 0) {
        showCheckerStatus('ë¯¸ì ìš© ë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤', 'info');
        return;
      }
      const nodeIds = errorItems.map(item => item.nodeId);
      parent.postMessage({
        pluginMessage: { type: 'select-multiple-nodes', nodeIds: nodeIds }
      }, '*');
    };

    // ===== ë¦¬ì‚¬ì´ì¦ˆ ê¸°ëŠ¥ =====
    const resizeHandle = document.getElementById('resizeHandle');
    let isResizing = false;
    let startX, startY, startWidth, startHeight;

    resizeHandle.addEventListener('mousedown', (e) => {
      isResizing = true;
      startX = e.clientX;
      startY = e.clientY;
      startWidth = window.innerWidth;
      startHeight = window.innerHeight;
      e.preventDefault();
    });

    document.addEventListener('mousemove', (e) => {
      if (!isResizing) return;

      const newWidth = Math.max(300, startWidth + (e.clientX - startX));
      const newHeight = Math.max(400, startHeight + (e.clientY - startY));

      parent.postMessage({
        pluginMessage: { type: 'resize', width: newWidth, height: newHeight }
      }, '*');
    });

    document.addEventListener('mouseup', () => {
      isResizing = false;
    });
  </script>
</body>
</html>
